import{a as l,j as e,u as pe,d as xe,e as fe}from"./vendor-data-B2h88IjC.js";import{t as m}from"./index-Cje_8L3Q.js";import{c as i,b as L,u as ge,C as w,a as T,d as S,e as v,B as p,I as he,f as C,g as ye,r as R}from"./input-BZXA1OJ3.js";import{R as je,P as Ne,C as E,T as O,D as z,a as M,A as P,O as U,b as be,c as we,d as ve,e as q,I as Q,S as $,f as Ce,g as B,h as K,i as F,j as Re,k as H,l as ke,L as J,m as _,U as De,n as Ae}from"./vendor-ui-YtWZSjw-.js";import{u as Te}from"./vendor-react-BDcrgNxs.js";const Se=je,Ie=Ne,G=l.forwardRef(({className:t,...s},a)=>e.jsx(U,{className:i("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));G.displayName=U.displayName;const V=l.forwardRef(({className:t,...s},a)=>e.jsxs(Ie,{children:[e.jsx(G,{}),e.jsx(E,{ref:a,className:i("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));V.displayName=E.displayName;const W=({className:t,...s})=>e.jsx("div",{className:i("flex flex-col space-y-2 text-center sm:text-left",t),...s});W.displayName="AlertDialogHeader";const X=({className:t,...s})=>e.jsx("div",{className:i("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});X.displayName="AlertDialogFooter";const Y=l.forwardRef(({className:t,...s},a)=>e.jsx(O,{ref:a,className:i("text-lg font-semibold",t),...s}));Y.displayName=O.displayName;const Z=l.forwardRef(({className:t,...s},a)=>e.jsx(z,{ref:a,className:i("text-sm text-muted-foreground",t),...s}));Z.displayName=z.displayName;const ee=l.forwardRef(({className:t,...s},a)=>e.jsx(P,{ref:a,className:i(L(),t),...s}));ee.displayName=P.displayName;const te=l.forwardRef(({className:t,...s},a)=>e.jsx(M,{ref:a,className:i(L({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));te.displayName=M.displayName;const Le=be,Ee=we,Oe=l.forwardRef(({className:t,inset:s,children:a,...d},x)=>e.jsxs($,{ref:x,className:i("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...d,children:[a,e.jsx(Ce,{className:"ml-auto h-4 w-4"})]}));Oe.displayName=$.displayName;const ze=l.forwardRef(({className:t,...s},a)=>e.jsx(B,{ref:a,className:i("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));ze.displayName=B.displayName;const se=l.forwardRef(({className:t,sideOffset:s=4,...a},d)=>e.jsx(ve,{children:e.jsx(q,{ref:d,sideOffset:s,className:i("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));se.displayName=q.displayName;const y=l.forwardRef(({className:t,inset:s,...a},d)=>e.jsx(Q,{ref:d,className:i("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",s&&"pl-8",t),...a}));y.displayName=Q.displayName;const Me=l.forwardRef(({className:t,children:s,checked:a,...d},x)=>e.jsxs(K,{ref:x,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",t),checked:a,...d,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(F,{children:e.jsx(Re,{className:"h-4 w-4"})})}),s]}));Me.displayName=K.displayName;const Pe=l.forwardRef(({className:t,children:s,...a},d)=>e.jsxs(H,{ref:d,className:i("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(F,{children:e.jsx(ke,{className:"h-2 w-2 fill-current"})})}),s]}));Pe.displayName=H.displayName;const Ue=l.forwardRef(({className:t,inset:s,...a},d)=>e.jsx(J,{ref:d,className:i("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...a}));Ue.displayName=J.displayName;const qe=l.forwardRef(({className:t,...s},a)=>e.jsx(_,{ref:a,className:i("-mx-1 my-1 h-px bg-muted",t),...s}));qe.displayName=_.displayName;const I={video:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",music:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",novel:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",comic:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",image:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",audio:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",rss:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",generic:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"},Qe={video:"rules.mediaTypeVideo",music:"rules.mediaTypeMusic",novel:"rules.mediaTypeNovel",comic:"rules.mediaTypeComic",image:"rules.mediaTypeImage",audio:"rules.mediaTypeAudio",rss:"rules.mediaTypeRss",generic:"rules.mediaTypeGeneric"};function We(){const{t}=ge(),s=Te(),a=pe(),[d,x]=l.useState(""),[j,N]=l.useState(null),{data:f,isLoading:ae,error:k}=xe({queryKey:["rules"],queryFn:R.list,staleTime:300*1e3}),re=fe({mutationFn:r=>R.delete(r),onSuccess:()=>{a.invalidateQueries({queryKey:["rules"]}),N(null),m.success(t("errors.deleted"))},onError:()=>{m.error(t("errors.deleteError"))}}),b=f?.filter(r=>{if(!d)return!0;const c=d.toLowerCase();return r.name.toLowerCase().includes(c)||r.description?.toLowerCase().includes(c)||r.tags?.some(o=>o.toLowerCase().includes(c))})?.reduce((r,c)=>{const o=c.mediaType;return r[o]||(r[o]=[]),r[o].push(c),r},{}),D=()=>{s("/rules/new")},A=r=>{s(`/rules/${r}`)},oe=r=>{re.mutate(r)},ne=async r=>{try{const c=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),o=URL.createObjectURL(c),n=document.createElement("a");n.href=o,n.download=`${r.name}.json`,n.click(),URL.revokeObjectURL(o),m.success(t("errors.exportSuccess"))}catch{m.error(t("errors.exportError"))}},le=async()=>{if(!f||f.length===0){m.warning(t("errors.noRulesToExport"));return}try{const r={version:"1.0",exportedAt:new Date().toISOString(),rules:f},c=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),o=URL.createObjectURL(c),n=document.createElement("a");n.href=o,n.download=`crawler-rules-${new Date().toISOString().split("T")[0]}.json`,n.click(),URL.revokeObjectURL(o),m.success(t("errors.exportAllSuccess",{count:f.length}))}catch{m.error(t("errors.exportError"))}},ie=()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.multiple=!0,r.onchange=async c=>{const o=c.target.files;if(!o||o.length===0)return;let n=0,u=0;for(const de of Array.from(o))try{const ce=await de.text(),g=JSON.parse(ce),me=Array.isArray(g)?g:g.rules?g.rules:[g];for(const h of me)try{if(!h.name||!h.mediaType||!h.match){u++;continue}const{id:Be,createdAt:Ke,updatedAt:Fe,...ue}=h;await R.create(ue),n++}catch{u++}}catch{u++}a.invalidateQueries({queryKey:["rules"]}),n>0&&u===0?m.success(t("errors.importSuccess",{count:n})):n>0&&u>0?m.warning(t("errors.importPartial",{count:n,errorCount:u})):m.error(t("errors.importError"))},r.click()};return ae?e.jsx("div",{className:"flex items-center justify-center min-h-100",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):k?e.jsxs(w,{className:"border-destructive",children:[e.jsx(T,{children:e.jsx(S,{className:"text-destructive",children:t("errors.error")})}),e.jsxs(v,{children:[e.jsx("p",{children:String(k)}),e.jsx(p,{className:"mt-4",onClick:()=>a.invalidateQueries({queryKey:["rules"]}),children:t("common.retry")})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:t("common.rules")}),e.jsx("p",{className:"text-muted-foreground",children:t("common.ruleEditorDescription")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:ie,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),t("common.import")]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:le,children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),t("common.exportAll")]}),e.jsx(p,{size:"sm",onClick:D,children:t("common.newRule")})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(he,{placeholder:t("common.searchRules"),value:d,onChange:r=>x(r.target.value),className:"max-w-sm"})}),b&&Object.keys(b).length>0?e.jsx("div",{className:"space-y-8",children:Object.entries(b).map(([r,c])=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:I[r]||I.generic,children:t(Qe[r]||"rules.mediaTypeGeneric")}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",c.length,")"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:c.map(o=>e.jsxs(w,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>A(o.id),children:[e.jsxs(T,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(S,{className:"text-lg line-clamp-1",children:o.name}),e.jsxs(Le,{children:[e.jsx(Ee,{asChild:!0,onClick:n=>n.stopPropagation(),children:e.jsx(p,{variant:"ghost",size:"sm",children:"···"})}),e.jsxs(se,{align:"end",children:[e.jsx(y,{onClick:n=>{n.stopPropagation(),A(o.id)},children:t("common.edit")}),e.jsx(y,{onClick:n=>{n.stopPropagation(),ne(o)},children:t("common.export")}),e.jsx(y,{className:"text-destructive",onClick:n=>{n.stopPropagation(),N(o.id)},children:t("common.delete")})]})]})]}),e.jsx(ye,{className:"line-clamp-2",children:o.description||t("common.noDescription")})]}),e.jsxs(v,{children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.tags?.slice(0,3).map(n=>e.jsx(C,{variant:"secondary",className:"text-xs",children:n},n)),o.tags&&o.tags.length>3&&e.jsxs(C,{variant:"secondary",className:"text-xs",children:["+",o.tags.length-3]})]}),o.author&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[t("common.author"),": ",o.author]})]})]},o.id))})]},r))}):e.jsx(w,{children:e.jsxs(v,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:t("common.noRules")}),e.jsx(p,{onClick:D,children:t("common.newRule")})]})}),e.jsx(Se,{open:!!j,onOpenChange:()=>N(null),children:e.jsxs(V,{children:[e.jsxs(W,{children:[e.jsx(Y,{children:t("common.confirmDelete")}),e.jsx(Z,{children:t("common.confirmDeleteDescription")})]}),e.jsxs(X,{children:[e.jsx(te,{children:t("common.cancel")}),e.jsx(ee,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>j&&oe(j),children:t("common.delete")})]})]})})]})}export{We as RuleListPage,We as default};
